(function(a,b){if(typeof define==="function"&&define.cmd){define(function(c){b(jQuery,window)})}else{if(typeof define==="function"&&define.amd){define(["Catalog"],b(jQuery,window))}else{window.Catalog=b(jQuery,window)}}}(this,function(b,a){var c={container:"body",active:"active",listen:undefined,animation:true,data:[{item:"",title:""}],callBack:undefined};if(!b){console.error("Catalog: jQuery should be included before jquery-catalog.js!")}function d(f,e){b(f).data("cat",this);this.$element=b(f);this.speed="";this.event={};this.options=b.extend({},c,e);this.init()}d.prototype={init:function(){var e=this;e.index=0;e.top=[];e.defend=true;e.$scrollDom=e.options.listen?b(e.options.listen):b(a);e.exOffsetTop=b(e.options.container).offset().top;e.curScroll=e.options.listen?e.$scrollDom.scrollTop():0;e.containerInit();e.createElement();e.bindEvent();e.winScroll();if(e.options.callBack&&typeof e.options.callBack==="function"){e.options.callBack()}},containerInit:function(){var e=this;a.onload=function(){e.$element.css("width",e.$element.css("width"))};e.$element.html("");if(e.$element.prop("class").indexOf("tocify")===-1){e.$element.addClass("tocify")}},createElement:function(){var e=this;e.dataParse(e.options.container,e.options.data,e.$element,function(g){var f=b("<ul class='tocify-header nav nav-list'></ul>");g.append(f);return f},function(h,g,f,i){h.append("<li class='tocify-item' data-selector='"+i.item+"' data-id='"+g+"'>"+"<a>"+f.find(i.title).text()+"</a></li>");f.attr("data-hash",g);e.top[g]=f.offset().top;e.index++})},dataParse:function(e,g,h,k,j){var m=this,i=JSON.parse(JSON.stringify(g)),l=i.shift(),f;f=k.call(m,h)||h;b(e).find(l.item).each(function(o,p){var n=m.index;j.call(m,f,n,b(p),l);if(i.length>0){m.dataParse(p,i,f,k,j)}})},bindEvent:function(){var e=this;e.scrollEvent(e.$element.parent().parent().offset().top);e.$element.off("click").on("click","li",function(){var j=b(this),f=j.data("selector")+"[data-hash='"+j.data("id")+"']",i=b(e.options.container).find(f),h=i.offset().top,g=e.options.listen?e.$scrollDom.scrollTop()+h-15:h-15;e.defend=false;e.changeActive(j);e.scrollSmooth(g);e.trigger("click")})},changeActive:function(f){var e=this;e.$element.find("li").removeClass(e.options.active);f.addClass(e.options.active);e.switchOpen(e);e.trigger("active")},switchOpen:function(e){b.each(e.$element.find("ul").splice(1,e.$element.find("ul").length-1),function(f,g){if(b(g).find("."+e.options.active).length===0&&b(g).prev("li").prop("class").indexOf(e.options.active)===-1){e.options.animation?b(g).slideUp("ease"):b(g).hide()}else{e.options.animation?b(g).slideDown("ease"):b(g).show()}})},scrollSmooth:function(k){var h=this,g,j=h.$element.parent().parent().offset().top,f=h.$scrollDom.scrollTop(),l=k-f,i=h.options.listen?h.$scrollDom.offset().top+15:j+15,e=h.options.listen?i:15;if(l!=0){h.defend=false;g=setInterval(function(){if((l>0&&k-f<l/20)||(l<0&&k-f>l/20)){h.options.listen?h.$scrollDom.scrollTop(k):a.scroll(0,k);clearInterval(g);h.defend=true}else{j=h.options.listen?h.$element.parent().parent().offset().top:j;f+=l/20;h.options.listen?h.$scrollDom.scrollTop(f):a.scroll(0,f);if(Math.abs(f-h.$scrollDom.scrollTop())>2){clearInterval(g);h.defend=true}else if(j<i){h.$element.parent().css({"position":"fixed","top":e+"px"})}}},10)}},winScroll:function(){var e=this;e.$scrollDom.scroll(function(){e.defend?e.scrollEvent():false})},scrollEvent:function(){var g=this,e=g.$scrollDom.scrollTop(),i=g.$element.parent().parent().offset().top,h=g.options.listen?g.$scrollDom.offset().top+15:e+15,f=g.options.listen?h:15;if(i<h){g.$element.parent().css({"position":"fixed","top":f+"px"})}else{if(i>h){g.$element.parent().css({"position":"relative","top":"0"})}}g.top.forEach(function(k,j){if(j>0&&e<g.top[j+1]+g.curScroll-15&&e>=k+g.curScroll-15){g.changeActive(b(g.$element).find("li[data-id='"+j+"']"))}else{if(j===0&&e<=g.top[0]+g.curScroll-15){g.changeActive(b(g.$element).find("li[data-id='0']"))}}return false})},on:function(e,f){this.event[e]=this.event[e]||[];this.event[e].push(f)},trigger:function(e,h){var g=this.event[e]||[];Array.prototype.shift.call(arguments);for(var f=0;f<g.length;f++){g[f].call(this,arguments)}}};b.fn["Catalog"]=function(f){var e;if(typeof f==="object"){return this.each(function(){new d(this,f)})}else{if(f==="refresh"){e=b(this).data("cat");if(e){e.index=0;e.top=[];e.defend=true;e.curScroll=e.options.listen?e.$scrollDom.scrollTop():0;e.containerInit();e.createElement();e.switchOpen(e);e.scrollEvent()}}else{if(f==="destroy"){e=b(this).data("cat");e.$scrollDom.off("scroll");e.$element.html("").removeClass("tocify")}else{return b(this).data("cat")}}}}}));
